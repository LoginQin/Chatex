ubuntu设置ap-wifi让android上网
***ubuntu没有设置root 密码 用su 切换会报错的，可以用 sudo -i 


1.安装hostapd dnsmasq
sudo apt-get install hostapd dnsmasq


2.开启IP转发
两种方式，
临时：echo “1″>/proc/sys/net/ipv4/ip_forward
固定：修改/etc/sysctl.conf，取消这一行的注释：
net.ipv4.ip_forward= 1
然后重启网络
sudo /etc/init.d/networking restart


3.设置iptables规则
临时：iptables -t nat -A POSTROUTING -j MASQUERADE
固定：
或者把上面这个写到一个启动脚本中。这里还有另外一个版本：
iptables -F
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -t nat -A POSTROUTING -s 192.168.137.0/24 -o eth1 -j MASQUERADE
据说“第一句是清除掉之前所有的iptables规则，第二第三句是允许接收和发送数据包，第四句是在eth1网口上NAT“，只是比上面的多了几句废话，最后指定网卡参数什么，还没试过。iptables的用法还得好好学。

然后把现在iptables的规则写进/etc/iptables.rules

sudo sh -c "iptables-save > /etc/iptables.rules"


4.配置hostapd.conf

配置hostapd,从例子中拷贝一份配置文件，如下：
# zcat /usr/share/doc/hostapd/examples/hostapd.conf.gz > /etc/hostapd/hostapd.conf
-----------------------------
interface=wlan0
bridge=br0 #方法二中有用到
driver=nl80211
ssid=wbyxu
hw_mode=g
channel=11
dtim_period=1
rts_threshold=2347
fragm_threshold=2346
macaddr_acl=0
auth_algs=3
ieee80211n=0
wpa=3
wpa_passphrase=* #设置密码
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP
-------------------------------
然后可以通过启动一个终端，运行:
#hostapd /etc/hostapd/hostapd.conf
配置并打开wlan0
# ifconfig wlan0 192.168.137.1


===============================DHCP===============

这时候，已经可以通过手机链接电脑了，但是还无法获得IP地址，因此在电脑上还需要安装DHCP服务器。
使用apt命令可以快速安装，如下：
# apt-get install isc-dhcp-server

安装晚成后，对其进行配置。同样，可以从例子中复制一份，然后修改，如下：
# cp /usr/share/doc/isc-dhcp-server/examples/dhcpd.conf /etc/dhcp/dhcpd.conf

然后用你喜爱的编辑器打开/etc/dhcp/dhcpd.conf，修改以下部分
...
subnet 10.5.5.0 netmask 255.255.255.224 {
  range 10.5.5.26 10.5.5.30;
  option domain-name-servers ns1.internal.example.org;
  option domain-name "internal.example.org";
  option routers 10.5.5.1;
  option broadcast-address 10.5.5.31;
  default-lease-time 600;
  max-lease-time 7200;
}
这里几乎是把例子中的注释去掉而已，没有增加什么内容。要注意的是这行
  option routers 10.5.5.1;
这个IP地址，10.5.5.1是无线网卡的地址。因为我们手机要通过电脑的无线网卡上网，因此无线网卡的IP地址就成了手机的路由器
的地址。
接着在另外的终端上启动dhcpd服务:
# dhcpd


